---
import type { CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import MaybeBookLink from './MaybeBookLink.astro';
import { slugify } from '@/utils/common-utils';

interface Props {
    book: CollectionEntry<'book'>;
    imageDirection?: 'left' | 'right';
    isLeafPage?: boolean;
}

const {
    book: {
        data: { title, publisher, year, image, url },
    },
    imageDirection = 'left',
    isLeafPage,
} = Astro.props;

const imageClasses = ['book-link', { left: imageDirection === 'left' }, { right: imageDirection === 'right' }];
---

<article class="book-preview">
    <MaybeBookLink href={`books/${slugify(title)}`} class:list={imageClasses} slot="image" isLink={!isLeafPage}>
        <Image src={image.src} alt={image.alt} width={300} height={439} class="book-image" />
    </MaybeBookLink>

    <div slot="text">
        <span class="title-wrapper">
            <h3 class="book-title">{title}</h3>
            <span class="purchase-link"><a href={url}>Purchase</a></span>
        </span>
        <p class="book-meta">{publisher && `${publisher}, `}{year}</p>
        <slot />
    </div>
</article>

<style>
    .book-title {
        font-size: var(--fs-500);
        font-weight: 500;
        margin: 0;
    }

    .book-meta {
        font-size: var(--fs-400);
        margin: 0;
    }

    .title-wrapper {
        display: flex;
        align-items: baseline;
        gap: var(--spacing-200);
    }

    .purchase-link {
        font-style: italic;
        font-size: var(--fs-300);
    }
</style>

<style is:global>
    .accreditation {
        margin-block-end: var(--spacing-400);
    }
</style>
