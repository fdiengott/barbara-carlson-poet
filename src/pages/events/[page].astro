---
import type { GetStaticPathsOptions, Page } from 'astro';
import { type CollectionEntry, getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { removeTemplates, sortByFileName } from '@/utils/data-utils';
import Card from '@/components/Card.astro';
import ExternalLink from '@/components/ExternalLink.astro';
import Pagination from '@/components/Pagination.astro';
import siteConfig from '@/config/site-config';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
    const events = removeTemplates(await getCollection('event')).sort(sortByFileName);

    return paginate(events, { pageSize: siteConfig.eventsPerPage || 4 });
}

type Props = { page: Page<CollectionEntry<'event'>> };

const { page } = Astro.props;
---

<BaseLayout title="Events" description="Events">
    <h1>Events</h1>
    <ul>
        {
            page.data.map((event) => (
                <Card>
                    <ExternalLink linkUrl={event.data.linkUrl} title={event.data.linkText} />
                    <p>{event.data.publication}</p>
                </Card>
            ))
        }
    </ul>
    <Pagination page={page} />
</BaseLayout>

<style>
    ul {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
</style>
